<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" href="SmallSwords.png?v=2" type="image/png" />
	<link rel="apple-touch-icon" href="BigSwords.png?v=2" type="image/png" />

	<meta charset="UTF-8"/>
	<meta name="description" content="Welcome to the unofficial Polytopia battle calculator! Try out a variety of combat situations and see what the end result is going to be." />
	<meta name="author" content="FrothFrenzy" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<meta property="og:title" content="Polytopia Battle Calculator" />
	<meta property="og:description" content="Welcome to the unofficial Polytopia battle calculator! Try out a variety of combat situations and see what the end result is going to be." />
	<meta property="og:image" content="http://polytopiacalculator.freevar.com/BigSwords.png" />

	<title>Polytopia Battle Calculator</title>

<style>
h2
{
	display: inline;
}
p
{
	max-height: 999999px;
	font-size: 17px;
}
p.i
{
	font-style: italic;
}
div.c
{
	font-size: 14px;
	max-height: 999999px;
}
input, button, select
{
	font-size: 16px;
}
</style>

</head>

<body onload="mobilescreen()">
<script>
var extinfo = [];
var tapcounter = 0;
var entries = 10;
var attackers = [];
var defenders = [];
var attackerselected = -1;
var defenderselected = -1;
var prevattackerselected = -2;
var deleteselected = false;
var backupattackers = [];
var backupdefenders = [];
var firstbackup = false;
var noretalswitch = true;

function messageclear()
{
	document.getElementById("resultatt").innerHTML = "";
	document.getElementById("resultdef").innerHTML = "";
	document.getElementById("resultsplash").innerHTML = "";
	document.getElementById("note").innerHTML = "";
}
function calculate(mode)
{
	var attforce, defforce, totaldam, res, testdef, multitestdef;
	var astring, bstring, cstring, unit1, unit2, defbonus = "";
	var warning = false;

	if (mode == "Multi")
	{
		var att = attackers[attackerselected].a;
		var def = defenders[defenderselected].d;
		var atthp = parseInt(attackers[attackerselected].hp);
		var defhp = parseInt(defenders[defenderselected].hp);
		var splashhp = parseInt(defenders[defenderselected].hp);
		var attorighp = parseInt(attackers[attackerselected].originalhp);
		var attmaxhp = attackers[attackerselected].maxhp;
		var defmaxhp = defenders[defenderselected].maxhp;
		var attname = attackers[attackerselected].type;
		var defname = defenders[defenderselected].type;
	}
	else
	{
		var att = parseFloat(document.getElementById("attack").value);
		var def = parseFloat(document.getElementById("defense").value);
		var atthp = parseInt(document.getElementById("attackhp").value);
		var defhp = parseInt(document.getElementById("defensehp").value);
		var splashhp = parseInt(document.getElementById("defensehp").value);
		var attmaxhp = parseInt(document.getElementById("attackmaxhp").value);
		var defmaxhp = parseInt(document.getElementById("defensemaxhp").value);
		var attname = document.getElementById("selectattacker").value;
		var defname = document.getElementById("selectdefender").value;
	}
	tapcounter = 0;
	if (mode != "Multi")
	{
		if (isNaN(att) == true || isNaN(def) == true || isNaN(atthp) == true ||
			  isNaN(defhp) == true || isNaN(attmaxhp) == true || isNaN(defmaxhp) == true)
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "All of the fields have to be filled with numbers!";
			scrollanchor.scrollIntoView(false);
		}
		else if (att < 0 || def < 0 || atthp < 1 || defhp < 1 || attmaxhp < 10 || defmaxhp < 10 || atthp > attmaxhp || defhp > defmaxhp ||
			(att % 0.5 != 0) || (def % 0.5 != 0) || (document.getElementById("attackhp").value % atthp != 0) || (document.getElementById("defensehp").value % defhp != 0) || 
				(document.getElementById("attackmaxhp").value % attmaxhp != 0) || (document.getElementById("defensemaxhp").value % defmaxhp != 0))
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "One or more invalid inputs:<br/>";
			if (att < 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attack value must be 0 or higher");
			}
			else if (att % 0.5 != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attack value must be divisible by 0.5");
			}
			if (atthp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP can't be lower than 1");
			}
			else if (document.getElementById("attackhp").value % atthp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP must be a whole number");
			}
			else if (atthp > attmaxhp && atthp > 0 && attmaxhp >= 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP cannot exceed max HP");
			}
			if (attmaxhp < 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker max HP must be 10 or higher");
			}
			else if (document.getElementById("attackmaxhp").value % attmaxhp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker max HP must be a whole number");
			}
			if (def < 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defense value must be 0 or higher");
			}
			else if (def % 0.5 != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defense value must be divisible by 0.5");
			}
			if (defhp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP can't be lower than 1");
			}
			else if (document.getElementById("defensehp").value % defhp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP must be a whole number");
			}
			else if (defhp > defmaxhp && defhp > 0 && defmaxhp >= 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP cannot exceed max HP");
			} 
			if (defmaxhp < 10)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender max HP must be 10 or higher");
			}
			else if (document.getElementById("defensemaxhp").value % defmaxhp != 0)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender max HP must be a whole number");
			}
			scrollanchor.scrollIntoView(false);
		}
	}
	if (warning != true && att == 123)
	{
		messageclear();
		warning = true;
		def = parseInt(document.getElementById("defense").value);
		if (def == 0)
		{
			document.getElementById("resultatt").innerHTML = "Combat history must contain at least 1 entry!";
			scrollanchor.scrollIntoView(false);
		}
		else
		{
			if (def == 1)
			{
				document.getElementById("resultatt").innerHTML = "Combat history limit set to 1 entry!";
			}
			else
			{
				document.getElementById("resultatt").innerHTML = "Combat history limit set to " +  def + " entries!";
			}
			extinfo.splice (def, (extinfo.length - 1));
			document.getElementById("extendedinfo").innerHTML = extinfo.join("");
			entries = def;
			scrollanchor.scrollIntoView(false);
		}
	}
	if (warning != true)
	{
		messageclear();
		testdef = false;
		if (mode == "Multi")
		{
			multitestdef = defenders[defenderselected].defbonus;
			if (multitestdef == "D")
			{
				testdef = true;
			}
		}
		else
		{
			testdef = document.getElementById("def1").checked;
		}
		if ((mode == "Multi") && (attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
		{
			atthp = attorighp;
		}
		attforce = att * (atthp / attmaxhp);
		defforce = def * (defhp / defmaxhp);

		if (testdef == true)
		{
			if (defname == "Amphibian")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Amphibians don't receive the defense bonus from cities!";
			}
			else if (defname == "Crab")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Crabs don't receive the defense bonus from cities!";
			}
			else if (defname == "Tridention")
			{
				defforce = defforce * 1.5;
				document.getElementById("note").innerHTML = "Note: Tridentions don't receive the defense bonus from cities!";
			}
			else if (defname == "Nature Bunny")
			{
				document.getElementById("note").innerHTML = "Note: Nature bunnies can't capture cities and don't have any defensive technologies! Defense bonus was disregarded in the result.";
			}
			else
			{
				defforce = defforce * 1.5;
				defbonus = "|D";
			}
		}
		testdef = false;
		if (mode == "Multi")
		{
			multitestdef = defenders[defenderselected].defbonus;
			if (multitestdef == "W")
			{
				testdef = true;
			}
		}
		else
		{
			testdef = document.getElementById("def2").checked;
		}
		if (testdef == true)
		{
			if (defname == "Boat" || defname == "Ship" || defname == "Battleship")
			{
				document.getElementById("note").innerHTML = "Note: Ships can't benefit from walls! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Navalon")
			{
				document.getElementById("note").innerHTML = "Note: Navalons can't benefit from walls! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Amphibian")
			{
				document.getElementById("note").innerHTML = "Note: Amphibians don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Crab")
			{
				document.getElementById("note").innerHTML = "Note: Crabs don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Tridention")
			{
				document.getElementById("note").innerHTML = "Note: Tridentions don't receive the defense bonus from cities! Wall bonus was disregarded in the result.";
			}
			else if (defname == "Nature Bunny")
			{
				document.getElementById("note").innerHTML = "Note: Nature bunnies can't capture cities! Wall bonus was disregarded in the result.";
			}
			else
			{
				defforce = defforce * 4;
				defbonus = "|W";
			}
		}
		if (attname == "Select Attacker")
		{
			unit1 = "Unit " + att + "|" + atthp + "|" + attmaxhp + " - ";
		}
		else
		{
			unit1 = attname + " " + att + "|" + atthp + "|" + attmaxhp + " - ";
		}
		if (defname == "Select Defender")
		{
			unit2 = "Unit " + def + "|" + defhp + "|" + defmaxhp + defbonus;
		}
		else
		{
			unit2 = defname + " " + def + "|" + defhp + "|" + defmaxhp + defbonus;
		}
		totaldam = attforce + defforce;
		res = Math.round(attforce / totaldam * att * 4.5);
		if (isNaN(res) == true)
		{
			res = 0;
		}
		if (attname == "Fire Dragon")
		{
			splashhp = splashhp - Math.floor(res / 2);
			if (splashhp > 0)
			{
				if (mode != "Multi")
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<p><i>IF SPLASHED:</i></p>Defender survives! Remaining HP:  " + splashhp;
				}
				else if (attackers[attackerselected].defendersattacked.length > 0)
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's splash attack.</i>";
				}
				else if (attackers[attackerselected].defendersattacked.length < 1)
				{
					if (document.getElementById("noretalbox").checked == true)
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i><p>Fire Dragon's main attack.</p>No enemy retaliation.</i>";
					}
					else
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's main attack.</i>";
					}
				}
			}
			else
			{
				if (mode != "Multi")
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<p><i>IF SPLASHED:</i></p>Defender is DESTROYED! Afterlife HP:  " + splashhp;
				}
				else if (attackers[attackerselected].defendersattacked.length > 0)
				{
					cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's splash attack.</i>";
				}
				else if (attackers[attackerselected].defendersattacked.length < 1)
				{
					if (document.getElementById("noretalbox").checked == true)
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i><p>Fire Dragon's main attack.</p>No enemy retaliation.</i>";
					}
					else
					{
						cstring = document.getElementById("resultsplash").innerHTML = "<i>Fire Dragon's main attack.</i>";
					}
				}
			}	
		}
		if ((attname == "Fire Dragon") && (mode == "Multi"))
		{
			if (attackers[attackerselected].defendersattacked.length > 0)
			{
				defhp = splashhp;
			}
			else
			{
				defhp = defhp - res;
			}
		}
		else
		{
			defhp = defhp - res;
		}

		if (mode != "Multi")
		{
			if (defhp > 0) 
			{
				bstring = document.getElementById("resultdef").innerHTML = "Defender survives! Remaining HP:  " + defhp;
				document.getElementById("defensehp").value = defhp;
				res = Math.round(defforce / totaldam * def * 4.5);
				if (isNaN(res) == true)
				{
					res = 0;
				}
				atthp = atthp - res;
			
				if (atthp > 0)
				{
					astring = document.getElementById("resultatt").innerHTML = "Attacker survives! Remaining HP:  " + atthp;
				}
				else
				{
					astring = document.getElementById("resultatt").innerHTML = "Attacker is DESTROYED! Afterlife HP:  " + atthp;
				}
			}
			else
			{
				bstring = document.getElementById("resultdef").innerHTML = "Defender is DESTROYED! Afterlife HP:  " + defhp;
				egg(att);
			}	
		}	

		if (mode == "Multi")
		{
			if (defhp > 0) 
			{
				bstring = document.getElementById("resultdef").innerHTML = "Defender survives! Remaining HP:  " + defhp;
				defenders[defenderselected].hp = defhp;
				res = Math.round(defforce / totaldam * def * 4.5);
				if (isNaN(res) == true)
				{
					res = 0;
				}
				if (document.getElementById("noretalbox").checked == false)
				{
					if ((attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
					{
					}
					else
					{
						atthp = atthp - res;
					}
				}
				if (atthp > 0)
				{
					if ((attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
					{
					}
					else
					{
						astring = document.getElementById("resultatt").innerHTML = "Attacker survives! Remaining HP:  " + atthp;
						attackers[attackerselected].hp = atthp;
					}
				}
				else
				{
					if ((attname == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
					{
					}
					else
					{
						astring = document.getElementById("resultatt").innerHTML = "Attacker is DESTROYED! Afterlife HP:  " + atthp;
						attackers[attackerselected].hp = atthp;
					}
				}
			}
			else
			{
				bstring = document.getElementById("resultdef").innerHTML = "Defender is DESTROYED! Afterlife HP:  " + defhp;
				defenders[defenderselected].hp = defhp;
			}

			if ((attackers[attackerselected].type != "Knight") && (attackers[attackerselected].type != "Navalon") && (attackers[attackerselected].type != "Fire Dragon"))
			{
				attackers[attackerselected].unavailable = true;
			}
			else if (attackers[attackerselected].type == "Fire Dragon")
			{
				attackers[attackerselected].defendersattacked.push(defenderselected);
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
			else
			{	
				if ((defhp > 0) || (atthp < 1))
				{
					attackers[attackerselected].unavailable = true;
				}
				else
				{
					attackers[attackerselected].defendersattacked.push(defenderselected);
				}
			}

			var decshort = "";
			var color = "black";
			if (attackers[attackerselected].type == "Knight")
			{
				decshort = "<b>3</b>";
			}
			else
			{
				decshort = attackers[attackerselected].a;
			}
			if ((attackers[attackerselected].hp < 1) || (attackers[attackerselected].unavailable == true))
			{
				color = "gray";
			}
			var splashindicator = ""
			if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
			{
				splashindicator = "S";
			}
			document.getElementById("attacker" + attackerselected).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
			document.getElementById("attacker" + attackerselected).style.borderColor = color;	

			color = "black"
			if (defenders[defenderselected].hp < 1)
			{
				color = "gray";
			}
			document.getElementById("defender" + defenderselected).innerHTML ="<img src='Defenders/" + defenders[defenderselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + defenders[defenderselected].defbonus + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + defenders[defenderselected].d + "/" + defenders[defenderselected].hp + "/" + defenders[defenderselected].maxhp + "</div>";
			document.getElementById("defender" + defenderselected).style.borderColor = color;

		}
		if ((mode == "Multi") && (attackers[attackerselected].type != "Fire Dragon") && (document.getElementById("noretalbox").checked == true) && (defenders[defenderselected].hp > 0))
		{
			cstring = document.getElementById("resultsplash").innerHTML = "<i>No enemy retaliation.</i>";	
		}
		if (mode == "Multi")
		{
			if ((attackers[attackerselected].type == "Archer") || (attackers[attackerselected].type == "Catapult") || (attackers[attackerselected].type == "Boat") || (attackers[attackerselected].type == "Ship") || (attackers[attackerselected].type == "Battleship") || (attackers[attackerselected].type == "Tridention"))
			{
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
		}
		if (astring == null)
		{
			astring = "";
		}
		if (cstring == null)
		{
			cstring = "";
		}

		if (extinfo.length >= entries)
		{
			extinfo.pop();
		}
		extinfo.splice(0, 0, "-------------------------------------------------------<p>" + unit1 + unit2 + "</p><p>" + astring + "</p><p>" + bstring + "</p><p>" + cstring + "</p>");
		document.getElementById("extendedinfo").innerHTML = extinfo.join("");

		if (mode != "Multi")
		{
			scrollanchor.scrollIntoView(false);
		}
	}
}
function defcheck()
{
	var test = document.getElementById("def2").checked;
	if (test == true)
	{
		document.getElementById("def2").checked = false;
	}
}
function wallcheck()
{
	var test = document.getElementById("def1").checked;
	if (test == true)
	{
		document.getElementById("def1").checked = false;
	}
}
function setdefbonus()
{
	var test = document.getElementById("def1").checked;
	if (test == true)
	{
		document.getElementById("def1").checked = false;
	}
	else
	{
		document.getElementById("def1").checked = true;
	}
	defcheck();
}
function setwallbonus()
{
	var test = document.getElementById("def2").checked;
	if (test == true)
	{
		document.getElementById("def2").checked = false;
	}
	else
	{
		document.getElementById("def2").checked = true;
	}
	wallcheck();
}
function clearform()
{
	document.getElementById("values").reset();
	document.getElementById("resultatt").innerHTML = "";
	document.getElementById("resultdef").innerHTML = "";
	document.getElementById("resultsplash").innerHTML = "";
	document.getElementById("note").innerHTML = "";
	document.getElementById("attveterancy").style.display='none';
	document.getElementById("attshiphp").style.display='none';
	document.getElementById("defveterancy").style.display='none';
	document.getElementById("defshiphp").style.display='none';
	document.getElementById("extendedinfo").style.display='none';
	document.body.scrollTop = document.documentElement.scrollTop = 0;
	tapcounter = 0;
}
function attackerfill()
{
	var getattacker = document.getElementById("selectattacker").value;
	switch (getattacker)
	{
		case "Warrior":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Catapult":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("attack").value = "3.5";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Giant":
			document.getElementById("attack").value = "5";
			document.getElementById("attackhp").value = "40";
			document.getElementById("attackmaxhp").value = "40";
			break;
		case "Boat":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Amphibian":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Crab":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "40";
			document.getElementById("attackmaxhp").value = "40";
			break;
		case "Tridention":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Polytaur":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Navalon":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "30";
			document.getElementById("attackmaxhp").value = "30";
			break;
		case "Baby Dragon":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Fire Dragon":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "20";
			document.getElementById("attackmaxhp").value = "20";
			break;
	}
	if (getattacker == "Warrior" || getattacker == "Rider" || getattacker == "Defender" || getattacker == "Swordsman" || getattacker == "Archer" || getattacker == "Catapult" || getattacker == "Knight" || getattacker == "Amphibian" || getattacker == "Tridention")
	{
		document.getElementById("attvetbox").checked = false;
		document.getElementById("attveterancy").style.display='inline';
		document.getElementById("attshiphp").style.display='none';
	}
	else if (getattacker == "Boat" || getattacker == "Ship" || getattacker == "Battleship")
	{
		document.getElementById("attshiphp").selectedIndex = "0";
		document.getElementById("attshiphp").style.display='inline';
		document.getElementById("attveterancy").style.display='none';
	}
	else
	{
		document.getElementById("attveterancy").style.display='none';
		document.getElementById("attshiphp").style.display='none';
	}
}
function defenderfill()
{
	var getdefender = document.getElementById("selectdefender").value;
	switch (getdefender)
	{
		case "Warrior":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Catapult":			
			document.getElementById("defense").value = "0";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Giant":
			document.getElementById("defense").value = "4";
			document.getElementById("defensehp").value = "40";
			document.getElementById("defensemaxhp").value = "40";
			break;
		case "Boat":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Mind Bender":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Amphibian":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Crab":
			document.getElementById("defense").value = "4";
			document.getElementById("defensehp").value = "40";
			document.getElementById("defensemaxhp").value = "40";
			break;
		case "Tridention":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Polytaur":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Navalon":
			document.getElementById("defense").value = "4";
			document.getElementById("defensehp").value = "30";
			document.getElementById("defensemaxhp").value = "30";
			break;
		case "Dragon Egg":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Baby Dragon":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Fire Dragon":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
		case "Nature Bunny":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
	}
	if (getdefender == "Warrior" || getdefender == "Rider" || getdefender == "Defender" || getdefender == "Swordsman" || getdefender == "Archer" || getdefender == "Catapult" || getdefender == "Knight" || getdefender == "Amphibian" || getdefender == "Tridention")
	{
		document.getElementById("defvetbox").checked = false;
		document.getElementById("defveterancy").style.display='inline';
		document.getElementById("defshiphp").style.display='none';
	}
	else if (getdefender == "Boat" || getdefender == "Ship" || getdefender == "Battleship")
	{
		document.getElementById("defshiphp").selectedIndex = "0";
		document.getElementById("defshiphp").style.display='inline';
		document.getElementById("defveterancy").style.display='none';
	}
	else
	{
		document.getElementById("defveterancy").style.display='none';
		document.getElementById("defshiphp").style.display='none';
	}
}
function egg(attack)
{
	if (attack > 9000)
	{
		document.getElementById("resultatt").innerHTML = "It's over 9000!!!";
		document.getElementById("note").innerHTML = "There's no way that can be right!";
	}
}
function attvettest()
{
	var test = document.getElementById("attvetbox").checked;
	if (test == true)
	{
		document.getElementById("attvetbox").checked = false;
	}
	else
	{
		document.getElementById("attvetbox").checked = true;
	}
	attackerveteran();
}
function defvettest()
{
	var test = document.getElementById("defvetbox").checked;
	if (test == true)
	{
		document.getElementById("defvetbox").checked = false;
	}
	else
	{
		document.getElementById("defvetbox").checked = true;
	}
	defenderveteran();
}
function attackerveteran()
{
	var getattacker = document.getElementById("selectattacker").value;
	var getattveterancy = document.getElementById("attvetbox").checked;
	switch (getattacker)
	{
		case "Warrior":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Catapult":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("attack").value = "3.5";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "Amphibian":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Tridention":
			document.getElementById("attack").value = "3";
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
	}
	var atthp = parseInt(document.getElementById("attackhp").value);
	var attmaxhp = parseInt(document.getElementById("attackmaxhp").value);
	if (getattveterancy == true)
	{
		document.getElementById("attackhp").value = atthp + 5;
		document.getElementById("attackmaxhp").value = attmaxhp + 5;
	}
}
function defenderveteran()
{
	var getdefender = document.getElementById("selectdefender").value;
	var getdefveterancy = document.getElementById("defvetbox").checked;
	switch (getdefender)
	{
		case "Warrior":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Rider":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Defender":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Swordsman":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Archer":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Catapult":
			document.getElementById("defense").value = "0";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Knight":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "Amphibian":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Tridention":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
	}
	var defhp = parseInt(document.getElementById("defensehp").value);
	var defmaxhp = parseInt(document.getElementById("defensemaxhp").value);
	if (getdefveterancy == true)
	{
		document.getElementById("defensehp").value = defhp + 5;
		document.getElementById("defensemaxhp").value = defmaxhp + 5;
	}
}
function attackershiphp()
{
	var getattacker = document.getElementById("selectattacker").value;
	var getattshiphp = document.getElementById("attshiphp").value;
	switch (getattacker)
	{
		case "Boat":
			document.getElementById("attack").value = "1";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("attack").value = "2";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("attack").value = "4";
			document.getElementById("attackhp").value = "10";
			document.getElementById("attackmaxhp").value = "10";
			break;
	}
	switch (getattshiphp)
	{
		case "HP 15":
			document.getElementById("attackhp").value = "15";
			document.getElementById("attackmaxhp").value = "15";
			break;
		case "HP 20":
			document.getElementById("attackhp").value = "20";
			document.getElementById("attackmaxhp").value = "20";
			break;
		case "HP 40":
			document.getElementById("attackhp").value = "40";
			document.getElementById("attackmaxhp").value = "40";
			break;
	}
}
function defendershiphp()
{
	var getdefender = document.getElementById("selectdefender").value;
	var getdefshiphp = document.getElementById("defshiphp").value;
	switch (getdefender)
	{
		case "Boat":
			document.getElementById("defense").value = "1";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Ship":
			document.getElementById("defense").value = "2";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
		case "Battleship":
			document.getElementById("defense").value = "3";
			document.getElementById("defensehp").value = "10";
			document.getElementById("defensemaxhp").value = "10";
			break;
	}
	switch (getdefshiphp)
	{
		case "HP 15":
			document.getElementById("defensehp").value = "15";
			document.getElementById("defensemaxhp").value = "15";
			break;
		case "HP 20":
			document.getElementById("defensehp").value = "20";
			document.getElementById("defensemaxhp").value = "20";
			break;
		case "HP 40":
			document.getElementById("defensehp").value = "40";
			document.getElementById("defensemaxhp").value = "40";
			break;
	}
}
function show(shown, hidden)
{
	document.body.scrollTop = document.documentElement.scrollTop = 0;
	document.getElementById(shown).style.display='block';
 	document.getElementById(hidden).style.display='none';
	tapcounter = 0;
	if ((document.getElementById("multibutton").innerText == "Single") && (deleteselected == true))
	{
		messageclear();
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
  	return false;
}
function displayextinfo()
{
	tapcounter++;
	if ((tapcounter > 2) && (document.getElementById("extendedinfo").style.display == 'none'))
	{
		tapcounter = 0;
		document.getElementById("extendedinfo").style.display='block';
		if (document.getElementById("multibutton").innerText == "Single")
		{
			states.scrollIntoView();
		}
		else
		{
			submitbutton.scrollIntoView();
		}
	}
	if ((tapcounter > 2) && (document.getElementById("extendedinfo").style.display == 'block'))
	{
		tapcounter = 0;
		document.getElementById("extendedinfo").style.display='none';
		scrollanchor.scrollIntoView(false);
	}
}
function choosetype()
{
	var unittype = document.getElementById("unitselect").value;
	if (unittype == "Create Attacker")
	{
		document.getElementById("attvalues").style.display='block';
		document.getElementById("attack").style.display='none';
		document.getElementById("attvaluetext").style.display='none';
		document.getElementById("attackmaxhp").style.display='none';
		document.getElementById("attmaxhptext").style.display='none';
		document.getElementById("defvalues").style.display='none';
	}
	else if (unittype == "Create Defender")
	{
		document.getElementById("defvalues").style.display='block';
		document.getElementById("defense").style.display='none';
		document.getElementById("defvaluetext").style.display='none';
		document.getElementById("defensemaxhp").style.display='none';
		document.getElementById("defmaxhptext").style.display='none';
		document.getElementById("attvalues").style.display='none';
		document.getElementById("def1").checked = false;
		document.getElementById("def2").checked = false;
	}
}
function multiswitch()
{
	if (document.getElementById("multibutton").innerText == "Multi")
	{
		document.getElementById("submitbutton").style.display='none';
		document.getElementById("createbutton").style.display='inline-block';
		document.getElementById("multibutton").innerText = "Single";
		document.getElementById("clearbutton").style.display='none';
		document.getElementById("deletebutton").style.display='inline-block';
		document.getElementById("singlefaq").style.display='none';
		document.getElementById("result").innerText = "Feedback:";
		document.getElementById("unitselect").style.display='block';
		document.getElementById("attackerlist").style.display='block';
		document.getElementById("defenderlist").style.display='block';
		document.getElementById("attackersheader").style.display='block';
		document.getElementById("defendersheader").style.display='block';
		document.getElementById("states").style.display='block';
		document.getElementById("def1").checked = false;
		document.getElementById("def2").checked = false;
		document.getElementById("selectattacker").selectedIndex = 1;
		attackerfill();
		document.getElementById("selectdefender").selectedIndex = 1;
		defenderfill();
		choosetype();
		document.body.scrollTop = document.documentElement.scrollTop = 0;
		tapcounter = 0;
	}
	else
	{
		document.getElementById("submitbutton").style.display='inline-block';
		document.getElementById("createbutton").style.display='none';
		document.getElementById("multibutton").innerText = "Multi";
		document.getElementById("clearbutton").style.display='inline-block';
		document.getElementById("deletebutton").style.display='none';
		document.getElementById("singlefaq").style.display='inline-block';
		document.getElementById("result").innerText = "Result:";
		document.getElementById("unitselect").style.display='none';
		document.getElementById("attvalues").style.display='block';
		document.getElementById("attvaluetext").style.display='block';
		document.getElementById("attmaxhptext").style.display='block';
		document.getElementById("attack").style.display='block';
		document.getElementById("attackmaxhp").style.display='block';
		document.getElementById("defvalues").style.display='block';
		document.getElementById("defvalues").style.display='block';
		document.getElementById("defvaluetext").style.display='block';
		document.getElementById("defmaxhptext").style.display='block';
		document.getElementById("defense").style.display='block';
		document.getElementById("defensemaxhp").style.display='block';
		document.getElementById("attvalues").style.display='block';
		document.getElementById("attackerlist").style.display='none';
		document.getElementById("defenderlist").style.display='none';
		document.getElementById("attackersheader").style.display='none';
		document.getElementById("defendersheader").style.display='none';
		document.getElementById("states").style.display='none';
		document.body.scrollTop = document.documentElement.scrollTop = 0;
		tapcounter = 0;
		if (deleteselected == true)
		{
			messageclear();
			deleteselected = false;
			document.getElementById("deletebutton").innerText = "Delete Units";
		}
	}
}
function createunit()
{
	tapcounter = 0;
	warning = false;
	if (deleteselected == true)
	{
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if (document.getElementById("unitselect").value == "Create Attacker")
	{
		var att = parseFloat(document.getElementById("attack").value);
		var atthp = parseInt(document.getElementById("attackhp").value);
		var attorighp = parseInt(document.getElementById("attackhp").value);
		var attmaxhp = parseInt(document.getElementById("attackmaxhp").value);
		var attname = document.getElementById("selectattacker").value;

		if ((document.getElementById("selectattacker").value == "Select Attacker") || (atthp < 1) || ((document.getElementById("attackhp").value % atthp) != 0) || (atthp > attmaxhp))
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "One or more invalid inputs:<br/>";
			if (document.getElementById("selectattacker").value == "Select Attacker")
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker must be selected from the template list");
			}
			if (atthp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP can't be lower than 1");
			}
			else if (document.getElementById("attackhp").value != atthp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP must be a whole number");
			}
			else if (atthp > attmaxhp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Attacker current HP cannot exceed max HP");
			}
			scrollanchor.scrollIntoView(false);
		}
	}	
	else if (document.getElementById("unitselect").value == "Create Defender")
	{
		var def = parseFloat(document.getElementById("defense").value);
		var defhp = parseInt(document.getElementById("defensehp").value);
		var defmaxhp = parseInt(document.getElementById("defensemaxhp").value);
		var defname = document.getElementById("selectdefender").value;
		
		if ((document.getElementById("selectdefender").value == "Select Defender") || (defhp < 1) || ((document.getElementById("defensehp").value % defhp) != 0) || (defhp > defmaxhp))
		{
			warning = true;
			messageclear();
			document.getElementById("resultatt").innerHTML = "One or more invalid inputs:<br/>";
			if (document.getElementById("selectdefender").value == "Select Defender")
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender must be selected from the template list");
			}
			if (defhp < 1)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP can't be lower than 1");
			}
			else if (document.getElementById("defensehp").value != defhp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP must be a whole number");
			}
			else if (defhp > defmaxhp)
			{
				resultatt.insertAdjacentHTML("beforeend", "<br/>- Defender current HP cannot exceed max HP");
			}
			scrollanchor.scrollIntoView(false);
		}
	}

	if ((document.getElementById("unitselect").value == "Create Attacker") && (warning != true))
	{
		attackers.push({type: attname, a: att, hp: atthp, maxhp: attmaxhp, unavailable: false, defendersattacked: [], originalhp: attorighp});
		var i = attackers.length - 1;
		var decshort = "";
		color = "black";
		
		if (attackers[i].type == "Knight")
		{
			decshort = "<b>3</b>";
		}
		else
		{
			decshort = attackers[i].a;
		}
		attackerlist.insertAdjacentHTML("beforeend", "<div class ='c' id='attacker" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='attackselector(" + i + ")'><img src='Attackers/" + attackers[i].type + ".png' height='55' width='55'><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[i].hp + "/" + attackers[i].maxhp + "</div></div>");
		messageclear();
		document.getElementById("resultatt").innerHTML = "Attacker created!";
	}
	else if ((document.getElementById("unitselect").value == "Create Defender") && (warning != true))
	{
		var defindicator = "";
		var color = "black";
		messageclear();

		if (document.getElementById("def1").checked == true)
		{
			defindicator = "D";
		}
		else if (document.getElementById("def2").checked == true)
		{
			defindicator = "W";
		}
		if ((defname == "Boat") || (defname == "Ship") || (defname == "Battleship") || (defname == "Navalon"))
		{
			if (defindicator == "W")
			{
				document.getElementById("note").innerHTML = "Note: " + defname + "s can't benefit from walls! Wall bonus was disregarded.";
				defindicator = "";
			}
		}
		else if ((defname == "Amphibian") || (defname == "Crab") || (defname == "Tridention"))
		{
			if (defindicator == "W")
			{
				document.getElementById("note").innerHTML = "Note: " + defname + "s don't receive the defense bonus from cities! Wall bonus was disregarded.";
				defindicator = "";
			}
			else if (defindicator == "D")
			{
				document.getElementById("note").innerHTML = "Note: " + defname + "s don't receive the defense bonus from cities!";
			}
		}	
		else if (defname == "Nature Bunny")
		{
			if (defindicator == "W")
			{
				document.getElementById("note").innerHTML = "Nature bunnies can't capture cities! Wall bonus was disregarded.";
				defindicator = "";
			}
			else if (defindicator == "D")
			{
				document.getElementById("note").innerHTML = "Nature bunnies can't capture cities and don't have any defensive technologies! Defense bonus was disregarded.";
				defindicator = "";
			}
		}
		defenders.push({type: defname, d: def, hp: defhp, maxhp: defmaxhp, defbonus: defindicator});
		var i = defenders.length - 1;
		defenderlist.insertAdjacentHTML("beforeend", "<div class ='c' id='defender" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='defenseselector(" + i + ")'><img src='Defenders/" + defenders[i].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + defenders[i].defbonus + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + defenders[i].d + "/" + defenders[i].hp + "/" + defenders[i].maxhp + "</div></div>");
		document.getElementById("resultatt").innerHTML = "Defender created!";
	}
}
function deleteunitprompt()
{
	tapcounter = 0;
	if ((attackers.length < 1) && (defenders.length < 1) && (deleteselected == false))
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "There are no units to delete!";
		scrollanchor.scrollIntoView(false);
	}
	else if (deleteselected == false)
	{
		deleteselected = true;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Select units to delete them. Tap or click the Delete Units button again to stop deleting.";
		document.getElementById("deletebutton").innerText = "Delete Units(x)";
		if (attackerselected >= 0)
		{
			var divselected = "attacker" + attackerselected;
			if(attackers[attackerselected].unavailable != true)
			{
				if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
				{
					var splashindicator = "";
					var decshort = attackers[attackerselected].a;
					attackers[attackerselected].unavailable = true;
					document.getElementById(divselected).style.borderColor = "gray";
					document.getElementById("attacker" + attackerselected).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
				}
				else
				{
					document.getElementById(divselected).style.borderColor = "black";
					if (document.getElementById("noretaltext").style.visibility == "visible")
					{
						document.getElementById("noretalbox").checked = false;
						document.getElementById("noretaltext").style.visibility = "hidden";
					}
				}
			}
			else
			{
				document.getElementById(divselected).style.borderColor = "gray";
				if (document.getElementById("noretaltext").style.visibility == "visible")
				{
					document.getElementById("noretalbox").checked = false;
					document.getElementById("noretaltext").style.visibility = "hidden";
				}
			}
			attackerselected = -1;
			defenderselected = -1;
			prevattackerselected = -2;
		}
	}
	else
	{
		deleteselected = false;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Unit deletion deactivated.";
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
}
function deleteunit(type)
{
	var selectedelement = "";
	var elementid ="";
	var test = "";
	tapcounter = 0;
	if (type == "Attacker")
	{
		attackers.splice(attackerselected, 1);
		selectedelement = "attacker" + attackerselected;
		elementid = document.getElementById(selectedelement);
		elementid.parentNode.removeChild(elementid);
		for (i = attackerselected; i < attackers.length; i++)
		{
			selectedelement = "attacker" + (i + 1);
			elementid = "attacker" + i;
			document.getElementById(selectedelement).setAttribute("onclick", "attackselector(" + i + ")");
			document.getElementById(selectedelement).setAttribute("id", elementid);
		}
	}
	if (type == "Defender")
	{
		defenders.splice(defenderselected, 1);
		selectedelement = "defender" + defenderselected;
		elementid = document.getElementById(selectedelement);
		elementid.parentNode.removeChild(elementid);
		for (i = defenderselected; i < defenders.length; i++)
		{
			selectedelement = "defender" + (i + 1);
			elementid = "defender" + i;
			document.getElementById(selectedelement).setAttribute("onclick", "defenseselector(" + i + ")");
			document.getElementById(selectedelement).setAttribute("id", elementid);
		}
	}
	attackerselected = -1;
	defenderselected = -1;
	prevattackerselected = -2;
}
function attackselector(attackernumber)
{
	attackerselected = attackernumber;
	if (deleteselected == true)
	{
		deleteunit("Attacker");
	}
	else
	{
		if ((attackers[attackerselected].type == "Archer") || (attackers[attackerselected].type == "Catapult") || (attackers[attackerselected].type == "Boat") || (attackers[attackerselected].type == "Ship") ||
			(attackers[attackerselected].type == "Battleship") || (attackers[attackerselected].type == "Tridention") || (attackers[attackerselected].type == "Fire Dragon"))
		{
			if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
			{
				document.getElementById("noretalbox").checked = true;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
			else
			{
				if(attackers[attackerselected].unavailable == true)
				{
					document.getElementById("noretalbox").checked = false;
					document.getElementById("noretaltext").style.visibility = "hidden";
				}
				else
				{
					if (noretalswitch == true)
					{
						document.getElementById("noretalbox").checked = true;
					}
					else
					{
						document.getElementById("noretalbox").checked = false;
					}
					document.getElementById("noretaltext").style.visibility = "visible";
				}
			}
		}
		else
		{
			document.getElementById("noretalbox").checked = false;
			document.getElementById("noretaltext").style.visibility = "hidden";
		}
		divselected = "";
		divselected = "attacker" + attackerselected;
		if(attackers[attackerselected].unavailable != true)
		{
			document.getElementById(divselected).style.borderColor = "green";
		}
		if ((prevattackerselected != -2) && (prevattackerselected != attackerselected))
		{
			divselected = "attacker" + prevattackerselected;
			if (attackers[prevattackerselected].unavailable == true)
			{
				document.getElementById(divselected).style.borderColor = "gray";
			}
			else if ((attackers[prevattackerselected].type == "Fire Dragon") && (attackers[prevattackerselected].defendersattacked.length > 0))
			{
				var splashindicator = "";
				var decshort = attackers[prevattackerselected].a;
				attackers[prevattackerselected].unavailable = true;
				document.getElementById(divselected).style.borderColor = "gray";
				document.getElementById("attacker" + prevattackerselected).innerHTML = "<img src='Attackers/" + attackers[prevattackerselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[prevattackerselected].hp + "/" + attackers[prevattackerselected].maxhp + "</div>";
			}
			else
			{
				document.getElementById(divselected).style.borderColor = "black";
			}
		}
		else if ((prevattackerselected != -2) && (prevattackerselected == attackerselected))
		{
			divselected = "attacker" + prevattackerselected;
			if (attackers[prevattackerselected].unavailable == true)
			{
				document.getElementById(divselected).style.borderColor = "gray";
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
			else if (attackers[prevattackerselected].defendersattacked.length > 0)
			{
				document.getElementById(divselected).style.borderColor = "gray";
				attackers[prevattackerselected].unavailable = true;
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
				if (attackers[prevattackerselected].type == "Fire Dragon")
				{
					var splashindicator = "";
					var decshort = attackers[prevattackerselected].a;
					document.getElementById("attacker" + prevattackerselected).innerHTML = "<img src='Attackers/" + attackers[prevattackerselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[prevattackerselected].hp + "/" + attackers[prevattackerselected].maxhp + "</div>";
				}
			}
			else
			{
				document.getElementById(divselected).style.borderColor = "black";
				document.getElementById("noretalbox").checked = false;
				document.getElementById("noretaltext").style.visibility = "hidden";
			}
		}
		if (prevattackerselected == attackerselected)
		{
			attackerselected = -1;
			prevattackerselected = -2;
		}
		else
		{
			prevattackerselected = attackerselected;
		}
	}
}
function noretalboxcheck()
{
	var test = document.getElementById("noretalbox").checked;
	if (test == true)
	{
		document.getElementById("noretalbox").checked = false;
	}
	else
	{
		document.getElementById("noretalbox").checked = true;
	}
}
function defenseselector(defendernumber)
{
	defenderselected = defendernumber;
	if (deleteselected == true)
	{
		deleteunit("Defender");
	}
	else
	{
		if (attackerselected != -1)
		{
			if ((defenders[defenderselected].hp > 0) && (attackers[attackerselected].unavailable == false))
			{
				if ((attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
				{
					var alreadyattacked = false;
					for (i = 0; i < attackers[prevattackerselected].defendersattacked.length; i++) 	
					{
						if (defenderselected == attackers[attackerselected].defendersattacked[i])
						{
							alreadyattacked = true;
						}
					}
					if (alreadyattacked == false)
					{
						calculate ("Multi");
					}
				}
				else
				{
					calculate ("Multi");
				}
				if ((attackers[attackerselected].type != "Knight") && (attackers[attackerselected].type != "Navalon") && (attackers[attackerselected].type != "Fire Dragon"))
				{
					attackerselected = -1;
					prevattackerselected = -2;
				}
				else if (attackers[attackerselected].type == "Fire Dragon")
				{
					if (attackers[attackerselected].unavailable == false)
					{
						var divselected = "attacker" + attackerselected;
						document.getElementById(divselected).style.borderColor = "green";
					}
					else
					{
						attackerselected = -1;
						prevattackerselected = -2;
					}
				}
				else
				{
					if (attackers[attackerselected].unavailable == false)
					{
						var divselected = "attacker" + attackerselected;
						document.getElementById(divselected).style.borderColor = "green";
					}
					else
					{
						attackerselected = -1;
						prevattackerselected = -2;
					}
				}
			}
		}
	}
}
function createbackup()
{
	tapcounter = 0;
	if (deleteselected == true)
	{
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if ((attackers.length < 1) && (defenders.length < 1))
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "At least one unit must be created before saving a state!";
		scrollanchor.scrollIntoView(false);
	}
	else
	{
		if ((attackerselected >= 0) && (attackers[attackerselected].type == "Fire Dragon") && (attackers[attackerselected].defendersattacked.length > 0))
		{
			var splashindicator = "";
			var decshort = attackers[attackerselected].a;
			var divselected = "attacker" + attackerselected;
			attackers[attackerselected].unavailable = true;
			document.getElementById(divselected).style.borderColor = "gray";
			document.getElementById("attacker" + attackerselected).innerHTML = "<img src='Attackers/" + attackers[attackerselected].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[attackerselected].hp + "/" + attackers[attackerselected].maxhp + "</div>";
			attackerselected = -1;
			prevattackerselected = -2;
		}
		backupattackers = [];
		backupdefenders = [];
		if (firstbackup == false)
		{
			firstbackup = true;
		}
		for (i = 0; i < attackers.length; i++)
		{
			backupattackers.push({type2: attackers[i].type, a2: attackers[i].a, hp2: attackers[i].hp, maxhp2: attackers[i].maxhp, unavailable2: attackers[i].unavailable, defendersattacked2: attackers[i].defendersattacked.slice(), originalhp2: attackers[i].originalhp});
		}
		for (i = 0; i < defenders.length; i++)
		{
			backupdefenders.push({type2: defenders[i].type, d2: defenders[i].d, hp2: defenders[i].hp, maxhp2: defenders[i].maxhp, defbonus2: defenders[i].defbonus});
		}
		messageclear();
		document.getElementById("resultatt").innerHTML = "State saved!";
		scrollanchor.scrollIntoView(false);
	}
}
function loadbackup()
{
	tapcounter = 0;
	if (deleteselected == true)
	{
		deleteselected = false;
		document.getElementById("deletebutton").innerText = "Delete Units";
	}
	if (firstbackup == false)
	{
		messageclear();
		document.getElementById("resultatt").innerHTML = "No data available. A state must be saved first!";
		scrollanchor.scrollIntoView(false);
	}
	else
	{
		attackers = [];
		defenders = [];
		attackerselected = -1;
		prevattackerselected = -2;
		for (i = 0; i < backupattackers.length; i++)
		{
			attackers.push({type: backupattackers[i].type2, a: backupattackers[i].a2, hp: backupattackers[i].hp2, maxhp: backupattackers[i].maxhp2, unavailable: backupattackers[i].unavailable2, defendersattacked: backupattackers[i].defendersattacked2.slice(), originalhp: backupattackers[i].originalhp2});
		}
		for (i = 0; i < backupdefenders.length; i++)
		{
			defenders.push({type: backupdefenders[i].type2, d: backupdefenders[i].d2, hp: backupdefenders[i].hp2, maxhp: backupdefenders[i].maxhp2, defbonus: backupdefenders[i].defbonus2});
		}
		document.getElementById("attackerlist").innerHTML = "";
		var decshort = "";
		var splashindicator = ""
		color = "";
		for (i = 0; i < attackers.length; i++) 	
		{
			color = "black";
			if (attackers[i].type == "Knight")
			{
				decshort = "<b>3</b>";
			}
			else
			{
				decshort = attackers[i].a;
			}
			if ((attackers[i].hp < 1) || (attackers[i].unavailable == true))
			{
				color = "gray";
			}
			splashindicator = ""
			if ((attackers[i].type == "Fire Dragon") &&(attackers[i].defendersattacked.length > 0) && (attackers[i].unavailable != true))
			{
				splashindicator = "S";
			}
			attackerlist.insertAdjacentHTML("beforeend", "<div class='c' id='attacker" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='attackselector(" + i + ")'><img src='Attackers/" + attackers[i].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + splashindicator + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + decshort + "/" + attackers[i].hp + "/" + attackers[i].maxhp + "</div></div>");
		}
		document.getElementById("defenderlist").innerHTML = "";
		for (i = 0; i < defenders.length; i++) 	
		{
			color = "black"
			if (defenders[i].hp < 1)
			{
				color = "gray";
			}
			defenderlist.insertAdjacentHTML("beforeend", "<div class='c' id='defender" + i + "' style='width: 56px; height: 80px; border-style: solid; border-color: " + color + "; display: inline-block; position: relative' onclick='defenseselector(" + i + ")'><img src='Defenders/" + defenders[i].type + ".png' height='55' width='55'><div style='position: absolute; top: 1px; right: 1px'><b>" + defenders[i].defbonus + "</b></div><div style='position: absolute; width: 100%; bottom: 2px; text-align: center'>" + defenders[i].d + "/" + defenders[i].hp + "/" + defenders[i].maxhp + "</div></div>");
		}
		messageclear();
		document.getElementById("resultatt").innerHTML = "State loaded!";
		scrollanchor.scrollIntoView(false);
	}
}
function noretaldefault()
{
	if (noretalswitch == true)
	{
		noretalswitch = false;
		messageclear();
		document.getElementById("resultatt").innerHTML = "Setting changed. Enemy units WILL retaliate on your ranged attacks by default.";
	}
	else
	{
		noretalswitch = true
		messageclear();
		document.getElementById("resultatt").innerHTML = "Setting changed. Enemy units WON'T retaliate on your ranged attacks by default.";
	}
}
function mobilescreen()
{
	if ((document.documentElement.clientWidth < 500) || (document.documentElement.clientHeight < 400))
	{
		var classlist = document.getElementsByClassName("minput");
		for (i = 0; i < classlist.length; i++)
		{
			document.getElementsByClassName("minput")[i].style.height = "21px";
			document.getElementsByClassName("minput")[i].style.fontSize = "17px";
		}
		classlist = document.getElementsByClassName("mbutton");
		for (i = 0; i < classlist.length; i++)
		{
			document.getElementsByClassName("mbutton")[i].style.height = "32px";
			document.getElementsByClassName("mbutton")[i].style.fontSize = "17px";
		}
		classlist = document.getElementsByClassName("mselect");
		for (i = 0; i < classlist.length; i++)
		{
			document.getElementsByClassName("mselect")[i].style.height = "30px";
			document.getElementsByClassName("mselect")[i].style.fontSize = "17px";
		}
		document.getElementById("main").style.visibility = "visible";
	}
	else
	{
		document.getElementById("main").style.visibility = "visible";
	}
}
</script>

<div id="main" style="visibility: hidden">
	<h2>Polytopia Battle Calculator</h2>
	<i style="display: inline-block">(by <a href="mailto:frothdiscord@gmail.com" target="_top">FrothFrenzy</a>)</i>

	<form id="values" onsubmit="return false" onkeypress="if (document.getElementById('multibutton').innerText == 'Single') {return event.keyCode != 13;}">
	<p><select id="unitselect" class= "mselect" onchange="choosetype()" style="display:none">
  		<option value="Create Attacker">Create Attacker
 		<option value="Create Defender">Create Defender
	</select></p>
	<div id="attvalues" style="display: inline">
		<p><select id="selectattacker" class= "mselect" onchange="attackerfill()" tabindex="-1">
  			<option value="Select Attacker">Select Attacker
 			<option value="Warrior">Warrior
		 	<option value="Rider">Rider
			<option value="Defender">Defender
			<option value="Swordsman">Swordsman
			<option value="Archer">Archer
			<option value="Catapult">Catapult
			<option value="Knight">Knight
			<option value="Giant">Giant
			<option value="Boat">Boat
			<option value="Ship">Ship
			<option value="Battleship">Battleship
			<option value="Amphibian">Amphibian
			<option value="Crab">Crab
			<option value="Tridention">Tridention
			<option value="Polytaur">Polytaur
			<option value="Navalon">Navalon
			<option value="Baby Dragon">Baby Dragon
			<option value="Fire Dragon">Fire Dragon
		</select>

		<span id="attveterancy" style="display:none"><span onclick="attvettest()">Veteran? </span><input type="checkbox" id="attvetbox" onclick="attackerveteran()"></span>
	
		<select id="attshiphp" class= "mselect" onchange="attackershiphp()" style="display:none" tabindex="-3">
  			<option value="HP 10">Max HP 10
 			<option value="HP 15">Max HP 15
  			<option value="HP 20">Max HP 20
 			<option value="HP 40">Max HP 40
		</select></p>

		<p id="attvaluetext">Attacker attack value:</p>
		<input type="number" id="attack" class="minput" min="0" step="0.5" required tabindex="1">
		<p>Attacker current HP:</p>
		<input type="number" id="attackhp" class="minput" min="1" required tabindex="2">
		<p id="attmaxhptext">Attacker max HP:</p>
		<input type="number" id="attackmaxhp" class="minput" min="10" required tabindex="3">
	</div>

	<div id="defvalues" style="display: inline;">
		<p><select id="selectdefender" class= "mselect" onchange="defenderfill()" tabindex="-4">
 	 		<option value="Select Defender">Select Defender
 			<option value="Warrior">Warrior
	 		<option value="Rider">Rider
			<option value="Defender">Defender
			<option value="Swordsman">Swordsman
			<option value="Archer">Archer
			<option value="Catapult">Catapult
			<option value="Knight">Knight
			<option value="Giant">Giant
			<option value="Boat">Boat
			<option value="Ship">Ship
			<option value="Battleship">Battleship
			<option value="Mind Bender">Mind Bender
			<option value="Amphibian">Amphibian
			<option value="Crab">Crab
			<option value="Tridention">Tridention
			<option value="Polytaur">Polytaur
			<option value="Navalon">Navalon
			<option value="Dragon Egg">Dragon Egg
			<option value="Baby Dragon">Baby Dragon
			<option value="Fire Dragon">Fire Dragon
			<option value="Nature Bunny">Nature Bunny
		</select>

		<span id="defveterancy" style="display:none"><span onclick="defvettest()">Veteran? </span><input type="checkbox" id="defvetbox" onclick="defenderveteran()"></span>

		<select id="defshiphp" class= "mselect" onchange="defendershiphp()" style="display:none" tabindex="-6">
  			<option value="HP 10">Max HP 10
 			<option value="HP 15">Max HP 15
  			<option value="HP 20">Max HP 20
 			<option value="HP 40">Max HP 40
		</select></p>

		<p id="defvaluetext">Defender defense value:</p>
		<input type="number" id="defense" class="minput" min="0" step="0.5" required tabindex="4">
		<p>Defender current HP:</p>
		<input type="number" id="defensehp" class="minput" min="1" required tabindex="5">
		<p id="defmaxhptext">Defender max HP:</p>
		<input type="number" id="defensemaxhp" class="minput" min="10" required tabindex="6">
	

		<p><span onclick="setdefbonus()">Defense bonus? </span><input type="checkbox" id="def1" onclick="defcheck()">&nbsp;
		<span onclick="setwallbonus()">Wall bonus? </span><input type="checkbox" id="def2" onclick="wallcheck()"></p>
	</div>

	<p><button id="submitbutton" type="submit" class="mbutton" onclick="calculate('Single')" tabindex="7">Calculate!</button>
	<button id="createbutton" type="button" class="mbutton" onclick="createunit()" style="display:none">Create Unit!</button>
	<button id="multibutton" type="button" class="mbutton" onclick="multiswitch()">Multi</button>
	<button id ="clearbutton" type="button" class="mbutton" onclick="clearform()">Clear</button>
	<button id="deletebutton" type="button" class="mbutton" onclick="deleteunitprompt()" style="display:none">Delete Units</button>
	&nbsp;<a id="singlefaq" href="#top" onclick="return show('faq', 'main')" target="_top">FAQ</a></p>
	</form>

	<p id="attackersheader" style="display:none"><b>Attackers:</b></p>
	<div id="attackerlist" style="display:none; width: 325px;"></div>
	<p id="defendersheader" style="display:none"><b onclick="noretaldefault()" style="margin-right: 95px">Defenders: </b><span id="noretaltext" style="visibility: hidden"><i onclick="noretalboxcheck()">No retaliation? </i><input type="checkbox" id="noretalbox"></span></p>
	<div id="defenderlist" style="display:none; width: 325px;"></div>

	<p id="states" style="display: none"><button type="button" class="mbutton" onclick="createbackup()">Save State</button>
	<button type="button" class="mbutton" onclick="loadbackup()">Load State</button>&nbsp;
	<a href="#top" onclick="return show('faq', 'main')" target="_top">FAQ</a></p>

	<p><b id="result">Result:</b></p>
	<div onclick="displayextinfo()">
		<p id="resultatt"><b><i>New update!</i></b> Press the Multi button and recreate your current battle state to try a variety of calculations in consecution.</p>
		<p id="resultdef">For more information, read the <a href="#top" onclick="return show('faq', 'main')" target="_top">FAQ</a>. Details on the Multi option are in the second question from the top.</p>
		<p id="resultsplash"></p>
		<p id="note" class="i"></p>
		<span id="scrollanchor"></span>
		<p id="extendedinfo" style="display:none"><p>
	</div>
</div>

<div id="faq" style="display:none">
	<h2>Frequently Asked Questions</h2><br/><br/><br/>
	
	<p><a href="javascript:;" onclick="return show('main', 'faq')" target="_top">&lt;&lt;&lt; Back to the calculator!</a></p><br/>
	
	<p><b>So how does the calculator work?</b></p>
	
	<p>The calculator uses the same code posted by the developer on the game wikia forums some time ago. You can find a link to this thread on the bottom of this FAQ. Here is the simplified code:</p>
	
	<p>accelerator = 4.5<br/>
	attackForce = attacker.attack * (attacker.health / attacker.maxHealth)<br/>
	defenseForce = defender.defense * (defender.health / defender.maxHealth)<br/>
	totalDamage = attackForce + defenseForce<br/><br/>
	attackResult = round((attackForce / totalDamage) * attacker.attack * accelerator)<br/>
	defenseResult = round((defenseForce / totalDamage) * defender.defense * accelerator)</p>
	
	<p>As for the actual usage - you simply input all of the fields, click the Calculate! button, and your battle result will pop up at the bottom. All of the fields are required because every variable affects the result. You can use drop-down unit templates to fill the fields quicker, although these can also be useful if you don't remember the unit stats. Additional details such as unit veterancy and variable ship HP will appear next to the template box once you have selected a relevant unit.<br/><br/>Defender's current HP is automatically updated if the defender survives, so you can keep pressing Calculate! repeatedly until it is destroyed. This is useful for quickly calculating how many units of the same power are needed to take down a stronger unit, and you don't need to manually change the defender's current HP every time you want to perform an attack with a different unit.<br/><br/>If checkboxes appear too small on your screen, you can instead click or tap on the text pertaining to the checkbox to activate it. This applies both to veterancy status and defense/wall bonus checkboxes.<br/><br/>Also note that you can access a history of all the recent battles you performed in the current session. Tap or click three times on any text that appears below Result: to activate the history. Likewise, you can turn it off by tapping or clicking three times in that same area. The history showcases 10 entries by default. If for some reason you would like to keep a bigger (or smaller) history for the current session, fill all the fields so there are no invalid values, set the attack value to 123, set the defense value to the number of entries you want to keep and then press the Calculate! button. A message will appear as a confirmation. All entries are formatted as Attacker (stats) - Defender (stats|D/W), where stats are shown in the same order as they appear on the calculator, and D/W representing the defense/wall bonus for the defender.</p>
	
	<p><b>What is the Multi option?</b></p>

	<p>This option allows you to recreate a battle state so you can try a variety of approaches in order to achieve optimal results. To use it, press the Multi button. This makes the calculator switch modes. You can always return to the original mode by pressing the Single button.<br/><br/>When in Multi mode, do the following:<br/><br/>- Create a battlefield of attackers and defenders by selecting between Choose Attacker or Choose Defender at the top.<br/><br/>- Select a unit type from the unit template list, change its current HP if necessary and tick additional modifiers, if any.<br/><br/>- Press the Create Unit! button. This creates a unit on the battlefield. If you created a defender and ticked a defensive bonus, the unit will have a letter indicating the bonus type in their upper right corner (D/W for defense/wall bonus).<br/><br/>- Repeat this process until you create the desired battle situation. You can create any number of units this way.<br/><br/>- Before you start battling, it is recommended that you press the Save State button. This will preserve the current battle situation and whatever you do, you can always press Load State to reload the battle state you previously saved. This is very useful when you want to try out multiple methods to resolve the situation.<br/><br/>- You can start battling now. Simply press on an attacker to select it, and then press on a defender. If possible, the battle will automatically take place. As long as you keep creating new units and/or have units available, you can perform any number of calculations.<br/><br/>- To delete units, press the Delete Units button and select the attackers or defenders you want to delete. Units selected this way will instantly disappear. To stop deleting, press the Delete Units button again. Pressing other buttons such as Create Unit! or opening the FAQ also stops the deletion process. When active, the Delete Units button will have an (x) appear within it.<br/><br/>As per standard gameplay mechanics, most units can attack only once. Once a unit is either dead or unavailable for attack, its border is automatically grayed out and it cannot be selected again. There are some exceptions...<br/><br/>Knights and navalons will be able to continue attacking as long as they are destroying enemy units. They become unavailable once an attack doesn't destroy an enemy unit, but you can also do so manually by pressing on them again while they are selected. This usually just deselects any unit but if a knight or a navalon already performed an attack, it will become unavailable this way.<br/><br/>Fire dragon's first attack is always its main attack. Every subsequent attack is its splash attack, which is indicated by the letter S appearing in its upper right corner. If the fire dragon's main attack was retaliated against, splash attacks will still be calculated with its original HP in mind. This is true even if the fire dragon was destroyed by the retaliation, in which case it will be treated as available to perform splash attacks. Since the main attack and all of the collateral splash attacks happen at once, the fire dragon becomes unavailable once you deselect it or select any other attacker after performing its main attack. Saving a state or prompting to delete units also triggers this.<br/><br/>Other than the exceptions above, you can freely select and deselect your available attackers however you wish. The calculator remembers which units attacked and which did not.<br/><br/>Another thing to note about the attacker knight is that its attack value will show as a bolded 3 instead of a regular 3.5. This is deliberate because additional symbols didn't fit well into the unit container in some battle situations. It otherwise has no effect on the battle result.<br/><br/>When selecting an available ranged unit, you are prompted with a No retaliation checkbox which prevents enemy units from retaliating. This setting is automatically ticked by default. However, if you have to perform a big number of calculations that take place between ranged units (such as in a sea battle), you can change this default setting by pressing on the "Defenders:" text. This will make enemy units retaliate by default. You can change back to the original setting by pressing the text again.<br/><br/>Since this mode uses some sprites from the game, the images won't appear if you download the calculator to use it offline. You'd have to download the image folders also while preserving the pathing context. Just in case, I'll be keeping the old calculator .html file on the Github repository if this update breaks anything (as <a href="https://frothfrenzy.github.io/polytopiacalculator/oldindex.html">oldindex.html</a>). Only Imperius and Xin-Xi sprites will be available out of respect for the developer.<br/><br/>The Multi mode uses the same code as the original single-battle calculator. This is why you will see the same values being filled and the same results being reported as before, even though most of them aren't visible in Multi mode. The battle history is also available while in Multi mode with additional info being preserved, including the No retaliation clause and the fire dragon's attack type.<br/><br/>To prevent accidental resets of huge battlefields, a button to clear everything isn't included. Simply refresh the calculator page if you want to start over, or delete the leftover units by pressing the Delete Units button.<br/><br/>It is also worth noting that Delete Units uses a method which is not supported by Internet Explorer versions below 8.0. If this is the case for you, it might be a sign you were waiting for that you need to upgrade.</p>

	<p><b>Where does the defense bonus come in?</b></p>

	<p>The defenceForce variable is increased by a factor of 1.5 if the defender is on a tile that provides a standard defense bonus (see below). If the defender is behind a wall, it's increased by a factor of 4. This corresponds to a 50% or 300% increase in defense, respectively. Because only the defenceForce variable is affected by this, you won't get the correct retaliation result if you were to apply the same factor to the defense value of the unit instead.</p>

	<p><b>Which tiles provide the standard defense bonus?</b></p>
	
	<p>Non-walled cities and defensive terrain for which you researched the relevant technology - Aquatism for water, Archery for forests and Meditation for mountains. If a player has any of these technologies, their units will have a shield appear around their HP when they are on tiles that provide the bonus. The shield will also appear on units that are in friendly cities, with a few exceptions - Aquarion amphibians, crabs and tridentions never receive the defense bonus from cities, even if they are walled.</p>

	<p><b>My unit is attacking from a tile that provides a defense bonus. Why is there no option that accounts for this?</b></p>

	<p>Contrary to popular belief, this has no effect on the result. You forfeit the bonus entirely. Your unit will receive full damage when the enemy unit retaliates.</p>

	<p><b>How does the retaliation damage work? Why does the calculator sometimes report that the defender was destroyed but no word on what happened to the attacker?</b></p>
	
	<p>The unit's defense value is used in place of its attack value to calculate the retaliation damage. This is why some units deal significantly less damage when retaliating, while the defender unit and units with defense bonuses deal more. Because all of the modifiers are already applied before dealing damage takes place, the defender's HP loss doesn't affect its retaliation result. Instead, it deals damage based on HP it had before combat began. However, if the attack outright destroys the defender, there is no retaliation. The attacker is unphased, so there's nothing for the calculator to report.</p>
	
	<p><b>I'm attacking an enemy with a ranged unit in Single mode, but that enemy doesn't hit back. The calculator says I receive damage anyway. Does this affect my damage result?</b></p>
	
	<p>No. It doesn't matter if an enemy unit is next to you, away from you, or if it is a ranged unit that doesn't retaliate because you're in your opponent's fog of war. Simply disregard the retaliation damage - the damage you deal is not affected in any of these cases. You can always use Multi mode which does offer the option of no enemy retaliation.</p>

	<p><b>Where can I see all the unit stats?</b></p>
	
	<p>If you use drop-down unit templates, the calculator will automatically fill all the relevant stats for the selected unit. For more info, you should read the unit page on the game's wikia site. You can find the link to this page at the bottom of this FAQ.</p>
	
	<p><b>How does the fire dragon's splash damage work?</b></p>
	
	<p>It is calculated in the same way as a regular attack. However, an additional line of code is added at the end:<br/><br/>
	defender.health = defender.health - floor(attackResult / 2);<br/><br/>

	This means that the unit receives half the damage it would normally receive if it was the main target, rounded down. So e.g. if the fire dragon would deal 11 damage to a unit by attacking it directly, that same unit would receive 5 damage (11/2=5.5=5) if it was splashed instead. Since nothing is altered in the original formula, the unit also benefits from its defense bonus, if any. Only the fire dragon's main target can retaliate, provided it survives the initial attack.
<br/><br/>
	In Single mode, both the main attack and splash damage results are provided to you simultaneously, calculated separately for the same defending unit. You either take one result or the other, depending on your follow-up. This is convenient if you're testing for damage in a group of units, so you can quickly get an idea which unit would be the most optimal to choose for the dragon's main attack. The calculator assumes the main attack will be the follow-up, and deducts that result from the defender's current HP.</p>
	
	<p><b>Can I use the calculator offline?</b></p>

	<p>Yes you can. Follow these instructions:<br/><br/>
	<i>PC</i>: Go to the calculator website, right-click on any empty space and press Save as... or Save Page As... to get the index.html file. Alternatively, you can download the file from my <a href="https://drive.google.com/open?id=0B7HGBGCiKHGkSUExdEs3Q2J1UG8" target="_blank">Google Drive</a> or <a href="https://github.com/frothfrenzy/polytopiacalculator" target="_blank">GitHub</a>. After you downloaded it, simply drag the .html file into your browser to run the calculator.<br/><br/>
	<i>iOS</i>: Repeat the PC process. Download an app called HTML Viewer Q by Spica. Connect your device to iTunes. In iTunes, select your device and go to File Sharing. Select HTML Viewer, press Add File and find the .html file you downloaded on your PC. Disconnect your device, run HTML Viewer and press on a book-like icon at the bottom right. Switch from Bookmarks to Files and select the downloaded .html file.<br/><br/>
	<i>Android</i>: Either repeat the PC process, or download the Google Drive app to fetch the .html file from my <a href="https://drive.google.com/open?id=0B7HGBGCiKHGkSUExdEs3Q2J1UG8" target="_blank">Google Drive</a>. If you used the PC, connect your device and transfer the .html file to it. If you used Google Drive, the file should be in your Downloads folder. Download the HTML Viewer app by Yogev Haham and run it. Press the paper-like icon at the upper right. Find and select the downloaded .html file, then press the browser view icon in the upper right.</p>

	<p><b>Who are you?</b></p>
	
	<p>I'm a big fan of the game and I've been playing it since early 2017. I have a tendency to learn every game I play in great detail as I'm hoping to pursue game design at some point. For about a year I was active over at the game's Discord server, which you should definitely join if you want to improve your game and meet other players. An invite to the server is posted at the bottom of this FAQ. I have since left Discord so I can focus on other things.</p>
	
	<p><b>How can I contact you?</b></p>
	
	<p>You can contact me via <a href="mailto:frothdiscord@gmail.com" target="_top">e-mail</a>. By all means contact me if you have any suggestions or bug reports regarding the calculator.</p>
	
	<p><b>What are Discord challenges?</b></p>
	
	<p>These are player-made, self-imposed limitations that alter the gameplay in some fundamental way. You can find the challenge list at the bottom of this FAQ. To be eligible for the scoreboard, you have to join Discord and post your results in the appropriate channel.</p>
	
	<p><b>How can I become a better player?</b></p>
	
	<p>Read through strategies on the game wikia, Reddit and Discord. Watch videos of experienced players on Youtube. Ask the player-base for help. Most important of all - play a lot, maximize your income and try to learn the mechanics behind the game. It will come in time. The links to help you with this are provided below.</p><br/>
	
	<p><b>Links:</b></p>
	
	<p><a href="https://discord.gg/YTFTuAq?" target="_blank">Discord</a><br/>
	<a href="http://polytopia.wikia.com/wiki/The_Battle_of_Polytopia_Wikia" target="_blank">Wikia</a><br/>
	<a href="https://www.reddit.com/r/Polytopia/" target="_blank">Reddit</a><br/><br/>
	
	<a href="http://www.midjiwan.com/polytopia.html" target="_blank">Official Game Website</a><br/>
	<a href="https://www.facebook.com/polytopia/" target="_blank">Official Game Facebook</a><br/><br/>
	
	<a href="https://twitter.com/midjiwan?lang=en" target="_blank">Midjiwan's Twitter</a><br/>
	<a href="https://www.instagram.com/midjiwan/" target="_blank">Midjiwan's Instagram</a><br/>
	<a href="https://www.youtube.com/channel/UCtBjQ-1WqlHrAjSaJUpKb0w" target="_blank">Midjiwan's Youtube Channel</a><br/>
	<a href="http://polytopia.wikia.com/wiki/Thread:920" target="_blank">Midjiwan's Wikia Post</a><br/>
	<a href="https://polytopia.wikia.com/wiki/Units" target="_blank">Wikia Unit Page</a><br/><br/>
	
	<a href="https://drive.google.com/open?id=0B7HGBGCiKHGkSFN2clluYnM0QlU" target="_blank">My Screenshots</a><br/><br/>

	<a href="https://www.youtube.com/playlist?list=PLQqaZ-kEj4Exd6EMDYTadaWbsFMoROwzw" target="_blank">My Videos</a><br/>
	<a href="https://www.youtube.com/playlist?list=PLfTvLAe72_3j5OHnUiyc1Cwo3Z6uiFmeC" target="_blank">Tupp's Videos</a><br/>
	<a href="https://www.youtube.com/channel/UCjwJEqv8LZOV6S12wAybURA" target="_blank">Dued03's Videos</a><br/>
	<a href="https://www.youtube.com/channel/UCEmKzVafcBQauZylIoomojw/videos?disable_polymer=1" target="_blank">Ze Biggest Potato's Videos</a><br/><br/>

	<a href="https://www.reddit.com/r/Polytopia/comments/6cjc4j/guide_quick_and_simple_guide_to_get_3_start_in/" target="_blank">Domination Guide by Airgibbo</a><br/>
	<a href="https://www.reddit.com/r/Polytopia/comments/6fslca/bardur_100k_points_strategy_guide/" target="_blank">Perfection Guide by Tupp</a><br/>
	<a href="https://www.reddit.com/r/Polytopia/comments/5qbppw/my_guide_to_high_scores_in_perfection_mode_based/" target="_blank">Perfection Guide by Illinois_Jones</a><br/>
	<a href="https://www.reddit.com/r/Polytopia/comments/85asn3/advanced_multiplayer_tribe_by_tribe_guide/" target="_blank">Multiplayer Guide by Will2Brown</a><br/><br/>
	
	<a href="https://drive.google.com/open?id=10vODoFZk-i670i56je_6G-XyZK7qHHEqp7xA-nYW4X8" target="_blank">Challenge List</a><br/><br/>

	<a href="https://github.com/frothfrenzy/polytopiacalculator/blob/master/Changelog.md" target="_blank">Changelog</a><br/><br/><br/>

	<a href="javascript:;" onclick="return show('main', 'faq')" target="_top">&lt;&lt;&lt; Back to the calculator!</a></p><br/>
</div>
</body>
</html>